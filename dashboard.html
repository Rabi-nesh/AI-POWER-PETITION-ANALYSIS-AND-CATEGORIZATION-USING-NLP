<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Petition Dashboard</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(to right, #4facfe, #00f2fe);
  padding: 20px;
}

h2 {
  text-align: center;
  color: white;
  margin-bottom: 20px;
  font-size: 32px;
  text-shadow: 2px 2px 5px #000;
}

.dashboard-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 25px;
  padding: 10px;
}

.chart-card {
  background: rgba(255, 255, 255, 0.25);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  padding: 20px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  text-align: center;
  transform: perspective(1000px) rotateX(2deg);
  transition: 0.3s;
}

.chart-card:hover {
  transform: perspective(1000px) rotateX(0deg) scale(1.03);
  box-shadow: 0 15px 30px rgba(0,0,0,0.3);
}

canvas {
  width: 100% !important;
  height: 300px !important;
}
</style>
</head>

<body>

<h2>Petition Analytics Dashboard</h2>

<div class="dashboard-container">
  
  <div class="chart-card">
    <h3>Like Rate</h3>
    <canvas id="likesChart"></canvas>
  </div>

  <div class="chart-card">
    <h3>Sentiment Analysis</h3>
    <canvas id="sentimentChart"></canvas>
  </div>

  <div class="chart-card">
    <h3>Priority Distribution</h3>
    <canvas id="priorityChart"></canvas>
  </div>

  <div class="chart-card">
    <h3>Urgency Levels</h3>
    <canvas id="urgencyChart"></canvas>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const token = localStorage.getItem("token");

async function loadDashboardData() {
    const res = await fetch("http://127.0.0.1:5000/api/dashboard", {
        headers: { "Authorization": "Bearer " + token }
    });

    const data = await res.json();

    buildCharts(data);
}

function buildCharts(data) {

    // LIKE RATE
    new Chart(document.getElementById('likesChart'), {
        type: 'bar',
        data: {
            labels: data.likes.labels,
            datasets: [{
                label: "Likes",
                data: data.likes.values,
                backgroundColor: 'rgba(0, 102, 255, 0.8)'
            }]
        }
    });

    // SENTIMENT GRAPH
    new Chart(document.getElementById('sentimentChart'), {
        type: 'pie',
        data: {
            labels: ["Positive", "Neutral", "Negative"],
            datasets: [{
                data: data.sentiment,
                backgroundColor: [
                    'rgba(0,255,0,0.7)',
                    'rgba(255,255,0,0.7)',
                    'rgba(255,0,0,0.7)'
                ]
            }]
        }
    });

    // PRIORITY GRAPH
    new Chart(document.getElementById('priorityChart'), {
        type: 'doughnut',
        data: {
            labels: ["High", "Medium", "Low"],
            datasets: [{
                data: data.priority,
                backgroundColor: [
                    'rgba(255,0,0,0.7)',
                    'rgba(255,165,0,0.7)',
                    'rgba(0,128,0,0.7)'
                ]
            }]
        }
    });

    // URGENCY GRAPH
    new Chart(document.getElementById('urgencyChart'), {
        type: 'bar',
        data: {
            labels: ["Critical", "High", "Medium", "Low"],
            datasets: [{
                label: "Urgency",
                data: data.urgency,
                backgroundColor: 'rgba(0,0,0,0.7)'
            }]
        }
    });
}

loadDashboardData();
</script>

</body>
</html>
